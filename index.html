<!DOCTYPE html>
<html>
<head>
    <title>My Global Pour | Collection</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ü•É</text></svg>">
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <style>
        body { margin: 0; padding: 0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; display: flex; background: #001f3f; overflow: hidden; }
        
        #sidebar {
            position: absolute; left: -320px; top: 0; width: 300px; height: 100vh; 
            background: #fdfbf7; border-right: 1px solid #d7ccc8; overflow-y: auto; 
            padding: 20px; box-sizing: border-box; z-index: 4000;
            transition: left 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 5px 0 15px rgba(0,0,0,0.5);
        }
        #sidebar.open { left: 0; }
        
        #map { height: 100vh; width: 100vw; background: #001f3f; position: relative; }
        
        #toggle-btn {
            position: absolute; top: 15px; left: 15px; z-index: 3000;
            background: #5d4037; color: white; border: none; padding: 12px 20px;
            border-radius: 50px; cursor: pointer; font-weight: bold; 
            box-shadow: 0 4px 10px rgba(0,0,0,0.4);
            font-size: 14px;
        }

        /* FLEXIBLE HEADER: Responds to the button position */
        .header-container {
            position: absolute; top: 20px; left: 50%; transform: translateX(-50%); z-index: 1000;
            text-align: center; pointer-events: none; width: auto;
            white-space: nowrap; transition: opacity 0.4s ease;
        }
        #map:has(.leaflet-popup) ~ .header-container { opacity: 0; }
        
        .header-container h1 { 
            margin: 0; font-size: 22px; color: white; 
            text-shadow: 0px 0px 10px rgba(0,0,0,0.9), 2px 2px 4px rgba(0,0,0,1); 
        }

        /* MOBILE FIX: Prevent overlap with the toggle button */
        @media (max-width: 600px) {
            .header-container { 
                top: 70px; /* Moves header below the button line on small screens */
                width: 100%;
            }
            .header-container h1 { font-size: 18px; letter-spacing: 1px; }
            #toggle-btn { padding: 10px 15px; font-size: 12px; }
        }

        .sidebar-header { margin-top: 50px; border-bottom: 2px solid #d7ccc8; padding-bottom: 15px; margin-bottom: 20px; }
        .filter-label { font-size: 11px; font-weight: bold; color: #8d6e63; text-transform: uppercase; margin-bottom: 5px; display: block; }
        
        .custom-select { 
            width: 100%; padding: 10px; margin-bottom: 15px; border-radius: 8px; 
            border: 1px solid #d7ccc8; background: #fff; cursor: pointer; font-weight: 600; color: #5d4037;
        }

        .emoji-marker {
            background: white; border-radius: 50%;
            text-align: center; line-height: 28px; font-size: 18px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.4);
            border: 3px solid #ccc;
        }
        .border-in-bar { border-color: #2e7d32 !important; }
        .border-not-in-bar { border-color: #d32f2f !important; }

        .tasting-card { padding: 5px; min-width: 220px; text-align: center; }
        .tasting-card h2 { margin: 0; font-size: 18px; color: #5d4037; text-transform: uppercase; font-weight: 800; }
        .sub-header { font-size: 12px; color: #8d6e63; font-weight: 600; margin: 4px 0 10px 0; }
        .one-liner-text { font-style: italic; font-size: 11px; color: #7f8c8d; font-weight: normal; }
        .region-country { font-size: 13px; color: #333; font-weight: 500; margin: 8px 0; }
        .tasting-card p { margin: 10px 0; font-size: 13px; line-height: 1.4; color: #444; text-align: left; border-top: 1px solid #eee; padding-top: 8px; }
        
        .status-badge { font-size: 10px; font-weight: bold; padding: 4px 10px; border-radius: 20px; text-transform: uppercase; display: inline-block; }
        .in-my-bar { background: #2e7d32; color: white; }
        .not-in-bar { background: #d32f2f; color: white; }

        .zoom-btn {
            display: block; width: 100%; padding: 12px; margin: 8px 0;
            background: #fff; border: 1px solid #d7ccc8; border-radius: 8px;
            text-align: left; cursor: pointer; color: #5d4037; font-weight: bold; font-size: 13px;
            border-left: 5px solid #ccc;
        }
        .list-in-bar { border-left-color: #2e7d32; }
        .list-not-in-bar { border-left-color: #d32f2f; }
    </style>
</head>
<body>

    <button id="toggle-btn" onclick="toggleSidebar()">‚ò∞ MyCollectionList</button>

    <div id="sidebar">
        <div class="sidebar-header">
            <h2 style="color: #5d4037; margin-bottom: 20px;">üçæ My Collection</h2>
            <select id="categoryFilter" class="custom-select" onchange="filterAll()">
                <option value="All">All Drinks Collection</option>
                <option value="Whiskey">Whiskey</option>
                <option value="Gin">Gin</option>
                <option value="Rum">Rum</option>
                <option value="Tequila">Tequila</option>
                <option value="Vodka">Vodka</option>
                <option value="Brandy">Brandy</option>
            </select>
            <select id="statusFilter" class="custom-select" onchange="filterAll()">
                <option value="All">Show All Status</option>
                <option value="In My Bar">In My Bar</option>
                <option value="Not in My Bar">Not in My Bar</option>
            </select>
        </div>
        <div id="stats-display" style="font-size:13px; color:#8d6e63; margin-bottom:20px; font-weight: 600;"></div>
        <div id="zoom-controls"></div>
    </div>

    <div id="map"></div>
    <div class="header-container">
        <h1>üó∫Ô∏è My Global Pour ü•É</h1>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        const spiritData = {
            "Vodka": { emoji: "üç∏", text: "A versatile, often neutral spirit made from grains or potatoes." },
            "Gin": { emoji: "üåø", text: "A neutral spirit flavored with juniper berries and botanical ingredients." },
            "Rum": { emoji: "üè¥‚Äç‚ò†Ô∏è", text: "Distilled from sugarcane byproducts like molasses or sugarcane juice." },
            "Tequila": { emoji: "üåµ", text: "A Mexican spirit distilled specifically from the blue agave plant." },
            "Whiskey": { emoji: "ü•É", text: "Distilled from fermented grain mash (barley, corn, rye, or wheat)." },
            "Brandy": { emoji: "üçá", text: "A spirit distilled from fermented fruit juice, most commonly grapes." }
        };

        var allData = [];
        var initialZoom = window.innerWidth < 600 ? 1.5 : 2.8;
        var initialCenter = [20, 0];

        var map = L.map('map', { 
            zoomControl: false, minZoom: 1, zoomSnap: 0.1,
            maxBounds: [[-85, -180], [85, 180]], maxBoundsViscosity: 1.0, worldCopyJump: false
        }).setView(initialCenter, initialZoom);

        L.control.zoom({ position: 'bottomright' }).addTo(map);
        L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer/tile/{z}/{y}/{x}', {
            noWrap: true, bounds: [[-90, -180], [90, 180]], attribution: 'Esri'
        }).addTo(map);

        function toggleSidebar() {
            var sidebar = document.getElementById('sidebar');
            sidebar.classList.toggle('open');
            if (!sidebar.classList.contains('open')) {
                map.flyTo(initialCenter, initialZoom);
                map.closePopup();
            }
        }

        window.addEventListener('resize', function() {
            map.invalidateSize();
        });

        var spreadsheetURL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSJGK6JrWMMmQ_hsZ-jXvoeDRWZOw0qIghhR5-8gMdU4UfdTImEaO0ogvJw01S8i5QWebwITE9CKaMO/pub?output=csv';

        function filterAll() {
            var catSelected = document.getElementById('categoryFilter').value;
            var statSelected = document.getElementById('statusFilter').value;
            var controls = document.getElementById('zoom-controls');
            controls.innerHTML = "";
            var visibleCount = 0;

            allData.forEach(function(item) {
                var matchesCat = (catSelected === "All" || item.category === catSelected);
                var matchesStat = (statSelected === "All" || item.statusFull === statSelected);

                if (matchesCat && matchesStat) {
                    map.addLayer(item.marker);
                    controls.appendChild(item.button);
                    visibleCount++;
                } else {
                    map.removeLayer(item.marker);
                }
            });

            let statusText = (catSelected === "All" && statSelected === "All") 
                ? `Showing all <b>${visibleCount}</b> drinks.` 
                : `Showing <b>${visibleCount}</b> ${catSelected === "All" ? "drinks" : catSelected}${statSelected === "All" ? "" : " ("+statSelected+")"}.`;
            document.getElementById('stats-display').innerHTML = statusText;
        }

        Papa.parse(spreadsheetURL, {
            download: true, header: true,
            complete: function(results) {
                results.data.forEach(function(item) {
                    var lat = parseFloat(item.Lat);
                    var lng = parseFloat(item.Long);

                    if(item.Name && !isNaN(lat) && !isNaN(lng)) {
                        var rawStatus = String(item.Status || "").trim().toLowerCase();
                        var isMyBar = (rawStatus.startsWith("in") || rawStatus === "mybar") && !rawStatus.includes("not");

                        var displayStatus = isMyBar ? "In My Bar" : "Not in My Bar";
                        var statusClass = isMyBar ? "in-my-bar" : "not-in-bar";
                        var borderClass = isMyBar ? "border-in-bar" : "border-not-in-bar";
                        var listClass = isMyBar ? "list-in-bar" : "list-not-in-bar";

                        var catInfo = spiritData[item.Category] || { emoji: "üç∑", text: "A premium selection." };

                        var emojiIcon = L.divIcon({
                            className: `emoji-marker ${borderClass}`,
                            html: catInfo.emoji,
                            iconSize: [30, 30],
                            iconAnchor: [15, 15]
                        });

                        var popupContent = `
                            <div class="tasting-card">
                                <h2>${item.Name}</h2>
                                <div class="sub-header">${catInfo.emoji} ${item.Category}</div>
                                <div class="status
